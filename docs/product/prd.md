# FocusOne 产品需求文档（PRD）

> 一款帮助用户管理专注时间、强制屏蔽分心应用的 iOS 效率工具。

---

## 1. 产品概述

### 1.1 产品定位

**FocusOne** 是一款面向 iOS 用户的专注力管理应用，通过系统级应用屏蔽（Screen Time API + Family Controls）帮助用户在专注时段内强制屏蔽分心应用，从而提升工作和学习效率。

### 1.2 目标用户

| 用户群体 | 特征 | 核心痛点 |
|---------|------|---------|
| 学生群体 | 16-25岁，需要备考或完成作业 | 学习时频繁被社交媒体打断 |
| 职场人士 | 25-40岁，知识工作者 | 工作时无法抵抗刷手机的冲动 |
| 自由职业者 | 需要高度自律的远程工作者 | 缺乏外部约束，容易分心 |
| 自我提升者 | 对个人成长有追求的用户 | 希望量化并改善时间使用习惯 |

### 1.3 核心价值主张

1. **强制屏蔽**：不同于普通提醒类应用，FocusOne 使用 iOS 系统级 API 真正阻止应用打开
2. **灵活计划**：支持一次性、每日、每周等多种重复模式
3. **数据洞察**：量化专注时长、成功率，帮助用户持续改进
4. **游戏化激励**：自律币、挑战系统（规划中）增加使用粘性

---

## 2. 功能模块

### 2.1 专注计划（核心功能）

#### 2.1.1 计划类型

| 类型 | 说明 | 使用场景 |
|------|------|---------|
| **一次性计划** | 立即开始，指定时长后结束 | 临时需要专注，如"现在开始专注30分钟" |
| **定时计划** | 指定开始和结束时间 | 固定时段专注，如"每天 9:00-12:00" |
| **周期计划** | 按周几重复的定时计划 | 工作日专注，如"周一到周五 14:00-17:00" |

#### 2.1.2 计划属性

```typescript
interface Plan {
  id: string;           // 唯一标识
  name: string;         // 计划名称
  start_min: number;    // 开始时间（当天分钟数）
  end_min: number;      // 结束时间（当天分钟数）
  repeat: number[];     // 重复规则（0=周日 ... 6=周六）
  apps: string[];       // 要屏蔽的应用列表
  mode: 'focus' | 'shield';  // 模式
}
```

#### 2.1.3 计划操作

| 操作 | 说明 | 触发条件 |
|------|------|---------|
| 创建计划 | 新建专注计划 | 用户在计划页面点击添加 |
| 编辑计划 | 修改已有计划 | 用户点击计划详情 |
| 删除计划 | 移除计划 | 用户左滑删除或详情页删除 |
| 暂停计划 | 临时暂停当前进行中的计划 | 用户点击暂停按钮 |
| 恢复计划 | 恢复已暂停的计划 | 用户点击继续按钮 |
| 退出计划 | 提前结束当前计划（扣除自律币） | 用户主动退出 |

### 2.2 快速开始

快速启动一次性专注任务的入口，简化操作流程。

**页面元素**：
- 应用选择器：选择要屏蔽的应用
- 时长滑块：设置专注时长（5-120分钟）
- 开始按钮：立即开始专注

**流程**：
1. 用户点击首页"快速开始"
2. 选择要屏蔽的应用
3. 设置专注时长
4. 点击开始 → 创建一次性计划 → 启动屏蔽

### 2.3 应用屏蔽（iOS 原生）

利用 iOS Screen Time API 实现系统级应用屏蔽。

#### 2.3.1 技术实现

```
┌─────────────────────────────────────┐
│          React Native 层            │
│   选择应用 → 设置时长 → 开始专注    │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│         Native Bridge 层            │
│  startAppLimits() / stopAppLimits() │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│       iOS Family Controls           │
│  • DeviceActivitySchedule           │
│  • ShieldExtension（屏蔽界面）       │
│  • MonitorExtension（活动监控）      │
└─────────────────────────────────────┘
```

#### 2.3.2 权限要求

- **Screen Time 权限**：必需，用于获取应用列表和设置限制
- **Family Controls 授权**：必需，用于创建屏蔽规则

#### 2.3.3 屏蔽效果

当用户尝试打开被屏蔽的应用时：
1. 系统弹出 Shield 界面，阻止应用启动
2. 显示"当前处于专注时间"提示
3. 用户无法绕过（除非主动退出计划）

### 2.4 专注记录与统计

#### 2.4.1 记录数据

```typescript
interface Record {
  id: string;
  plan_id: string;
  title: string;
  start_min: number;      // 开始时间
  total_min: number;      // 计划时长
  actual_min: number;     // 实际完成时长
  status: 'completed' | 'failed' | 'in_progress';
  created_at: string;
}
```

#### 2.4.2 统计指标

| 指标 | 说明 | 计算方式 |
|------|------|---------|
| 总专注时长 | 累计实际专注分钟数 | `SUM(actual_min)` |
| 成功率 | 完成计划的比例 | `completed / total * 100%` |
| 平均单次时长 | 每次专注的平均时长 | `AVG(actual_min)` |
| 连续天数 | 连续有专注记录的天数 | 按日期统计 |

#### 2.4.3 展示维度

- 今日统计
- 本周统计
- 本月统计
- 历史趋势图（规划中）

### 2.5 用户系统

#### 2.5.1 登录方式

| 方式 | 优先级 | 说明 |
|------|--------|------|
| Apple Sign-in | P0 | iOS 必需，首选登录方式 |
| 微信登录 | P1 | 国内用户常用 |
| 手机号登录 | P2 | 备选方式 |

#### 2.5.2 用户信息

```typescript
interface UserInfo {
  id: string;
  username: string;
  phone?: string;
  avatar?: string;
  created_at: string;
}
```

### 2.6 权益系统

#### 2.6.1 自律币

虚拟货币，用于激励用户坚持专注。

| 操作 | 自律币变化 |
|------|-----------|
| 完成专注计划 | +N（根据时长） |
| 暂停专注计划 | -1 |
| 提前退出计划 | -N（根据已投入） |
| 每日签到 | +1（规划中） |

#### 2.6.2 会员权益（规划中）

| 权益 | 免费用户 | VIP 用户 |
|------|---------|---------|
| 可屏蔽应用数 | 3 个 | 无限制 |
| 每日专注时长 | 60 分钟 | 无限制 |
| 计划数量 | 3 个 | 无限制 |
| 详细统计报告 | ✗ | ✓ |
| 专属主题 | ✗ | ✓ |

### 2.7 挑战系统（MVP 隐藏）

游戏化功能，提升用户粘性。

#### 2.7.1 挑战类型

```typescript
interface Challenge {
  id: string;
  title: string;
  difficulty: 'easy' | 'normal' | 'hard';
  goal_total_mins: number;    // 目标总时长
  goal_once_mins: number;     // 单次最低时长
  goal_repeat_times: number;  // 需完成次数
  entry_coins: number;        // 入场自律币
  reward_apps: number;        // 奖励可选应用数
  reward_duration: number;    // 奖励专注时长
}
```

#### 2.7.2 挑战流程

1. **领取挑战**：用户支付入场自律币，选择关联计划
2. **进行中**：系统自动追踪进度
3. **完成/失败**：根据结果发放奖励或扣除自律币

---

## 3. 页面结构

### 3.1 导航架构

```
App
├── (tabs)/                    # 底部标签导航
│   ├── index.tsx             # 专注页（首页）
│   ├── record.tsx            # 统计页
│   ├── challenges.tsx        # 挑战页（MVP 隐藏）
│   └── user.tsx              # 我的页
│
├── plans/                     # 计划管理
│   ├── index.tsx             # 计划列表
│   ├── add.tsx               # 新建计划
│   └── item.tsx              # 计划详情
│
├── apps/                      # 应用管理
│   ├── index.tsx             # 应用列表
│   └── add.tsx               # 添加应用
│
├── quick-start/               # 快速开始
│   └── index.tsx             # 快速启动页
│
├── login/                     # 登录认证
│   ├── start.tsx             # 登录引导
│   ├── wx.tsx                # 微信登录
│   └── register.tsx          # 注册
│
├── setting/                   # 设置
│   ├── index.tsx             # 设置主页
│   ├── about.tsx             # 关于我们
│   ├── feedback.tsx          # 意见反馈
│   └── permission.tsx        # 权限管理
│
├── onboarding/                # 新手引导
│   └── index.tsx             # 引导流程
│
└── user/                      # 用户相关
    ├── edit.tsx              # 编辑资料
    ├── vip.tsx               # VIP 页面
    └── coins.tsx             # 自律币
```

### 3.2 核心页面说明

#### 3.2.1 首页（专注页）

**状态1：无进行中的计划**
- 显示下一个计划信息
- 快速开始入口
- 今日专注统计

**状态2：有进行中的计划**
- 显示计时器（倒计时/正计时）
- 暂停/继续按钮
- 退出按钮
- 被屏蔽的应用列表

#### 3.2.2 统计页

- 今日/本周/本月切换
- 专注时长统计
- 成功率展示
- 历史记录列表

#### 3.2.3 我的页

- 用户信息展示
- VIP 入口
- 权限管理
- 意见反馈
- 设置入口

---

## 4. 核心用户流程

### 4.1 新用户引导流程

```
启动 App
    │
    ▼
┌─────────────┐
│  欢迎页面    │ ← 产品价值介绍
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  权限预热    │ ← 解释为何需要权限
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  请求权限    │ ← Screen Time 权限
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  选择应用    │ ← 选择3个想屏蔽的应用
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  体验专注    │ ← 1分钟专注体验
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  进入首页    │
└─────────────┘
```

### 4.2 开始专注流程

```
用户点击"快速开始"
    │
    ▼
选择要屏蔽的应用
    │
    ▼
设置专注时长
    │
    ▼
点击"开始专注"
    │
    ├──→ 检查权限
    │       │
    │       ├─ 权限未授予 → 跳转权限设置
    │       │
    │       └─ 权限已授予 ↓
    │
    ▼
创建专注记录
    │
    ▼
调用 iOS API 启动屏蔽
    │
    ▼
返回首页，显示计时器
    │
    ▼
┌─────────────────────────────────┐
│           专注进行中             │
│                                 │
│  • 用户尝试打开被屏蔽应用        │
│    → 显示 Shield 界面           │
│                                 │
│  • 用户点击暂停                  │
│    → 暂停计时，解除屏蔽          │
│    → 扣除1个自律币               │
│                                 │
│  • 用户点击退出                  │
│    → 结束计划，标记为失败        │
│    → 扣除自律币                  │
│                                 │
│  • 时间到                        │
│    → 自动完成，奖励自律币        │
│    → 显示完成弹窗                │
└─────────────────────────────────┘
```

---

## 5. 技术约束

### 5.1 平台限制

| 约束 | 说明 |
|------|------|
| 仅支持 iOS | 应用屏蔽依赖 iOS Family Controls API |
| iOS 16+ | Family Controls API 最低版本要求 |
| 需要 Screen Time 权限 | 核心功能依赖此权限 |

### 5.2 API 依赖

- 后端 API：`https://focus.ruidoc.cn/dev-api`
- PostHog：数据分析和 A/B 实验
- Stripe：支付集成（规划中）
- 微信 SDK：微信登录

### 5.3 存储策略

| 数据类型 | 存储方式 | 理由 |
|---------|---------|------|
| 计划数据 | MMKV | 高频读写，需要快速响应 |
| 用户信息 | AsyncStorage | 低频访问，需要持久化 |
| Token | MMKV + App Groups | 主 App 和 Extension 共享 |
| 专注状态 | App Groups | Extension 需要读取 |

---

## 6. 版本规划

### 6.1 MVP（当前版本）

**核心功能**：
- [x] 专注计划管理（创建/编辑/删除）
- [x] 快速开始一次性专注
- [x] iOS 应用屏蔽（Screen Time）
- [x] 专注记录与基础统计
- [x] 用户登录（Apple/微信/手机号）
- [x] 自律币基础系统
- [x] 新手引导流程

**隐藏功能**：
- [ ] 挑战系统（代码已完成，入口隐藏）
- [ ] VIP 会员系统

### 6.2 V1.1（计划中）

- [ ] 详细统计报告（图表展示）
- [ ] VIP 会员系统上线
- [ ] 应用使用时长统计
- [ ] 小组件支持

### 6.3 V1.2（计划中）

- [ ] 挑战系统正式上线
- [ ] 社交功能（好友排行）
- [ ] 专注白噪音
- [ ] 自定义 Shield 界面

---

## 7. 成功指标

### 7.1 核心指标

| 指标 | 定义 | 目标 |
|------|------|------|
| 日活用户 (DAU) | 每日启动 App 的独立用户数 | - |
| 专注完成率 | 完成的专注计划 / 开始的专注计划 | > 70% |
| 次日留存率 | 次日回访用户 / 新增用户 | > 40% |
| 7日留存率 | 7日后回访用户 / 新增用户 | > 20% |
| 付费转化率 | 付费用户 / 活跃用户 | > 5% |

### 7.2 用户行为指标

| 指标 | 定义 |
|------|------|
| 平均专注时长 | 用户每次专注的平均分钟数 |
| 日均专注次数 | 用户每天启动专注的次数 |
| 屏蔽应用数 | 用户选择屏蔽的应用数量 |
| 暂停率 | 暂停次数 / 专注次数 |
| 退出率 | 提前退出次数 / 专注次数 |

---

## 8. 相关文档

- [系统架构文档](../ARCHITECTURE.md)
- [增长计划](../growth/plan.md)
- [新手引导方案 A](../onboarding/planA.md)
- [新手引导方案 B](../onboarding/planB.md)
- [Family Controls 配置](../develop/family-controls-setup.md)

---

*文档版本：1.0*
*最后更新：2026-01-31*
